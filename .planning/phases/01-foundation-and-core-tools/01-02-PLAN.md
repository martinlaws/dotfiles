---
phase: 01-foundation-and-core-tools
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - scripts/install-tools.sh
  - setup
autonomous: false

must_haves:
  truths:
    - "All CLI tools from Brewfile are installed and available in PATH"
    - "User sees progress while tools install"
    - "If a tool fails, user is prompted to continue or abort"
    - "Completion report shows what was installed with versions"
  artifacts:
    - path: "scripts/install-tools.sh"
      provides: "CLI tools installation via Brewfile"
      contains: "brew bundle"
    - path: "setup"
      provides: "Complete Phase 1 flow"
      contains: "install-tools.sh"
  key_links:
    - from: "setup"
      to: "scripts/install-tools.sh"
      via: "sh source"
      pattern: "sh.*install-tools"
    - from: "scripts/install-tools.sh"
      to: "config/Brewfile"
      via: "brew bundle"
      pattern: "brew bundle.*Brewfile"
---

<objective>
Implement CLI tools installation via Brewfile and create completion report with detailed output.

Purpose: Complete the Phase 1 flow - after Homebrew is installed, install all CLI tools and show a beautiful completion report so user knows exactly what they have.

Output: Working end-to-end setup that installs all CLI tools and displays a detailed report of installed software and next steps.
</objective>

<execution_context>
@/Users/mlaws/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mlaws/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-core-tools/01-CONTEXT.md
@.planning/phases/01-foundation-and-core-tools/01-RESEARCH.md
@.planning/phases/01-foundation-and-core-tools/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement CLI tools installation with progress and error handling</name>
  <files>
    scripts/install-tools.sh
    setup
  </files>
  <action>
Create the tools installation script and integrate into setup:

1. **scripts/install-tools.sh**:
   - Source lib/detect.sh and lib/ui.sh
   - Display section header: "Installing CLI Tools" with ui_section

   - Check if all tools already installed:
     ```bash
     if brew bundle check --file="$SCRIPT_DIR/../config/Brewfile" >/dev/null 2>&1; then
         ui_success "All tools already installed"
         return 0
     fi
     ```

   - Install tools with progress:
     - If NOT verbose: use `ui_spin "Installing CLI tools..." brew bundle install --file=config/Brewfile`
     - If verbose: run `brew bundle install --file=config/Brewfile` directly to show output

   - Handle partial failures per CONTEXT decision (prompt per failure):
     - After brew bundle, check which tools failed: `brew bundle check --file=config/Brewfile`
     - For each failed tool, use `ui_confirm "Tool X failed. Continue anyway?"`
     - If user says no, exit with error
     - If user says yes, continue and note the skipped tool

   - Track what was installed vs skipped for the report

2. **scripts/show-report.sh** (or inline function in install-tools.sh):
   - Per CONTEXT decision: "End of Phase 1: Detailed report"
   - Display beautiful completion report using Gum:
     ```
     ╔══════════════════════════════════════════╗
     ║     Phase 1 Complete: Foundation Ready   ║
     ╚══════════════════════════════════════════╝

     Installed:
       ✓ Homebrew (4.x.x) - /opt/homebrew
       ✓ git (2.x.x)
       ✓ node (22.x.x)
       ✓ pnpm (9.x.x)
       ✓ gh (2.x.x)
       ✓ tree (2.x.x)
       ✓ gum (0.17.x)
       ✓ stow (2.x.x)

     Paths:
       Homebrew: /opt/homebrew
       Shell config: ~/.zprofile (updated)

     Next steps:
       Run Phase 2 to symlink dotfiles and configure Git/SSH
     ```
   - Get versions dynamically: `brew --version | head -1`, `git --version`, etc.
   - Show any skipped tools with warning icon

3. **Update setup**:
   - Call install-tools.sh after install-homebrew.sh
   - Call show-report at the end
   - The full flow:
     1. Welcome header
     2. Install Homebrew (Plan 01)
     3. Install CLI tools (this plan)
     4. Show completion report
  </action>
  <verify>
    - `bash -n scripts/install-tools.sh` validates syntax
    - With Homebrew installed but tools missing: `sh setup` installs all tools from Brewfile
    - With all tools installed: `sh setup` shows "All tools already installed"
    - After completion: `command -v git && command -v node && command -v pnpm && command -v gh && command -v tree && command -v gum && command -v stow` all succeed
    - Completion report displays with tool versions
  </verify>
  <done>
    - install-tools.sh installs all CLI tools via brew bundle
    - Progress is shown during installation (spinner or verbose output)
    - Partial failures prompt user per tool (per CONTEXT decision)
    - Completion report shows all installed tools with versions
    - Full setup flow works end-to-end
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete Phase 1 setup</name>
  <what-built>
Complete Phase 1 foundation: project structure, Homebrew installation, CLI tools installation, and completion report.
  </what-built>
  <how-to-verify>
Run the full setup on your Mac (even if Homebrew is already installed, it will test idempotency):

1. **Run setup:**
   ```bash
   cd ~/dotfiles
   sh setup
   ```

2. **Verify beautiful UI:**
   - Welcome header should display with Gum styling
   - Progress indicators should show during tool installation
   - Completion report should show all installed tools

3. **Verify tools installed:**
   ```bash
   which git && git --version
   which node && node --version
   which pnpm && pnpm --version
   which gh && gh --version
   which tree && tree --version
   which gum && gum --version
   which stow && stow --version
   ```

4. **Verify idempotency (re-run):**
   ```bash
   sh setup
   ```
   Should show "already installed" messages and skip installation steps.

5. **Verify verbose mode:**
   ```bash
   sh setup -v
   ```
   Should show actual command output instead of spinners.

6. **Check project structure:**
   ```bash
   ls -la setup scripts/ config/
   ```
   Should show: setup, scripts/lib/, scripts/install-homebrew.sh, scripts/install-tools.sh, config/Brewfile
  </how-to-verify>
  <resume-signal>Type "approved" if everything works, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
Complete Phase 1 verification:

1. **Project structure:**
   ```bash
   ls -la setup scripts/lib/ scripts/*.sh config/
   ```

2. **All CLI tools available:**
   ```bash
   for tool in git node pnpm gh tree gum stow; do
     echo -n "$tool: " && command -v $tool && $tool --version | head -1
   done
   ```

3. **Homebrew configured:**
   ```bash
   which brew
   brew --prefix
   grep "brew shellenv" ~/.zprofile
   ```

4. **Full idempotent run:**
   ```bash
   sh setup  # Should complete quickly, showing "already installed" for everything
   ```
</verification>

<success_criteria>
- [ ] Running `sh setup` completes full Phase 1 flow
- [ ] All CLI tools (git, node, pnpm, gh, tree, gum, stow) are installed and in PATH
- [ ] Completion report shows all tools with versions
- [ ] Re-running setup is idempotent (skips already-installed items)
- [ ] Verbose mode (-v) shows full output
- [ ] UI is beautiful with Gum styling (balanced emoji per CONTEXT)
- [ ] Project structure matches: setup, scripts/lib/, scripts/*.sh, config/Brewfile
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-core-tools/01-02-SUMMARY.md`
</output>
