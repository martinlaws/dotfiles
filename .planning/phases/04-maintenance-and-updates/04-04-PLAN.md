---
phase: 04-maintenance-and-updates
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/show-report.sh
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Setup script runs successfully in both first-time and update modes"
    - "show_update_report function is callable when UPDATE_MODE=true"
    - "show_first_time_report function is callable in default mode"
  artifacts:
    - path: "scripts/show-report.sh"
      provides: "Report display for both modes"
      contains: "show_update_report"
  key_links:
    - from: "scripts/show-report.sh"
      to: "mode routing logic"
      via: "function definitions before calls"
      pattern: "show_update_report.*\\(\\).*\\{[\\s\\S]*UPDATE_MODE"
---

<objective>
Fix function call order in show-report.sh to resolve "command not found" error

Purpose: The setup script fails in update mode because show_update_report() is called at line 19 before it's defined at line 254. This blocker prevents all update functionality from working.

Output: Working show-report.sh that correctly defines functions before calling them
</objective>

<execution_context>
@/Users/mlaws/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mlaws/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-maintenance-and-updates/04-UAT.md

# Gap source - UAT Test 1 failure
# Root cause: Function call before definition
# User reported: "/Users/mlaws/dotfiles/scripts/show-report.sh: line 19: show_update_report: command not found"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reorder show-report.sh to define functions before calling them</name>
  <files>scripts/show-report.sh</files>
  <action>
Restructure scripts/show-report.sh to follow correct bash function ordering:

CURRENT (broken) order:
1. Source libraries (lines 1-16)
2. Mode check + call show_update_report (lines 17-21) <-- CALLS BEFORE DEFINED
3. show_first_time_report definition (lines 24-251)
4. show_update_report definition (lines 254-335)
5. Call show_first_time_report (lines 337-338)

REQUIRED order:
1. Source libraries (keep as-is)
2. show_first_time_report() function definition (move from current location)
3. show_update_report() function definition (move from current location)
4. Mode routing: if UPDATE_MODE=true, call show_update_report, else call show_first_time_report
5. exit 0

The fix is purely structural - move the two function definitions ABOVE the mode check logic, then have the mode check call the appropriate function.

Do NOT change any function internals - only their location in the file.
  </action>
  <verify>
Run: UPDATE_MODE=true bash -n scripts/show-report.sh && echo "Syntax OK"
Run: bash -n scripts/show-report.sh && echo "Syntax OK"
Both should print "Syntax OK" without errors.

Then verify the actual execution works:
Run: UPDATE_MODE=true ./scripts/show-report.sh 2>&1 | head -5
Should NOT show "command not found" error.
  </verify>
  <done>
scripts/show-report.sh has correct function ordering: libraries -> function definitions -> mode routing -> exit.
Both UPDATE_MODE=true and default mode execute without "command not found" errors.
  </done>
</task>

</tasks>

<verification>
1. Syntax check passes: `bash -n scripts/show-report.sh`
2. Update mode runs: `UPDATE_MODE=true ./scripts/show-report.sh` shows update report UI (not "command not found")
3. Default mode runs: `./scripts/show-report.sh` shows first-time report UI
4. Full setup works: `./setup` completes without show-report.sh errors
</verification>

<success_criteria>
- scripts/show-report.sh defines all functions before the mode routing logic
- UPDATE_MODE=true triggers show_update_report() without errors
- Default mode triggers show_first_time_report() without errors
- UAT Test 1 blocker is resolved
</success_criteria>

<output>
After completion, create `.planning/phases/04-maintenance-and-updates/04-04-SUMMARY.md`
</output>
