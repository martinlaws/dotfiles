---
phase: 05-fix-update-mode-integration-breaks
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/update-dotfiles.sh
  - scripts/update-apps.sh
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Update mode dotfiles refresh completes without stow errors"
    - "App drift detection correctly identifies installed casks from Brewfile.apps"
    - "Running ./setup with existing state successfully refreshes dotfiles and detects app drift"
  artifacts:
    - path: "scripts/update-dotfiles.sh"
      provides: "Dotfile symlink refresh"
      contains: 'STOW_PACKAGES="git shell terminal editors ssh"'
    - path: "scripts/update-apps.sh"
      provides: "App drift detection"
      contains: "Brewfile.apps"
  key_links:
    - from: "scripts/update-dotfiles.sh"
      to: "dotfiles/ directory packages"
      via: "STOW_PACKAGES variable"
      pattern: "STOW_PACKAGES.*git.*shell.*terminal.*editors.*ssh"
    - from: "scripts/update-apps.sh"
      to: "config/Brewfile.apps"
      via: "BREWFILE variable"
      pattern: "BREWFILE.*Brewfile\\.apps"
---

<objective>
Fix stow package names and Brewfile reference in update scripts

Purpose: Two one-line errors are blocking update mode functionality. The stow packages list references non-existent package names, and the app drift detection reads from the wrong Brewfile. These were identified in the v1.0 milestone audit.

Output: Working update-dotfiles.sh and update-apps.sh that correctly reference their configuration sources
</objective>

<execution_context>
@/Users/mlaws/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mlaws/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Gap source - v1.0 Milestone Audit
# Integration gaps:
# 1. scripts/update-dotfiles.sh:67 - Stow package name mismatch
# 2. scripts/update-apps.sh:20 - References wrong Brewfile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix stow package names in update-dotfiles.sh</name>
  <files>scripts/update-dotfiles.sh</files>
  <action>
On line 67, change:
  STOW_PACKAGES="git zsh hyper vscode ssh starship"

To:
  STOW_PACKAGES="git shell terminal editors ssh"

The current names (zsh, hyper, vscode, starship) do not exist in the dotfiles/ directory.
The actual stow package directories are: git, shell, terminal, editors, ssh

This is a single line change. Do not modify anything else in the file.
  </action>
  <verify>
Run: grep "STOW_PACKAGES=" scripts/update-dotfiles.sh
Should output: STOW_PACKAGES="git shell terminal editors ssh"

Then verify packages exist:
Run: ls dotfiles/
Should show: editors git shell ssh terminal
  </verify>
  <done>
STOW_PACKAGES variable matches actual directory names in dotfiles/.
stow -R commands will find existing packages instead of failing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Brewfile reference in update-apps.sh</name>
  <files>scripts/update-apps.sh</files>
  <action>
On line 20, change:
  BREWFILE="$SCRIPT_DIR/config/Brewfile"

To:
  BREWFILE="$SCRIPT_DIR/config/Brewfile.apps"

The current reference points to config/Brewfile which contains only CLI tools (brew formulae).
The cask definitions for GUI apps are in config/Brewfile.apps.

This is a single line change. Do not modify anything else in the file.
  </action>
  <verify>
Run: grep "BREWFILE=" scripts/update-apps.sh
Should output: BREWFILE="$SCRIPT_DIR/config/Brewfile.apps"

Then verify file contains casks:
Run: grep "^cask " config/Brewfile.apps | head -3
Should show cask definitions like: cask "google-chrome"
  </verify>
  <done>
BREWFILE variable points to Brewfile.apps which contains cask definitions.
App drift detection correctly compares installed casks against the app catalog.
  </done>
</task>

</tasks>

<verification>
1. Stow packages match: `grep "STOW_PACKAGES=" scripts/update-dotfiles.sh` shows "git shell terminal editors ssh"
2. Brewfile correct: `grep "BREWFILE=" scripts/update-apps.sh` shows "Brewfile.apps"
3. Syntax valid: `bash -n scripts/update-dotfiles.sh && bash -n scripts/update-apps.sh && echo "OK"`
4. Integration test: With state file present, `./scripts/update-dotfiles.sh` runs without "package does not exist" errors
5. Integration test: `./scripts/update-apps.sh` shows actual cask drift (not all apps as manual installs)
</verification>

<success_criteria>
- scripts/update-dotfiles.sh references actual stow package names: git, shell, terminal, editors, ssh
- scripts/update-apps.sh references Brewfile.apps (not Brewfile)
- Both scripts execute without errors when run standalone
- Update mode successfully refreshes dotfiles and detects app drift
</success_criteria>

<output>
After completion, create `.planning/phases/05-fix-update-mode-integration-breaks/05-01-SUMMARY.md`
</output>
