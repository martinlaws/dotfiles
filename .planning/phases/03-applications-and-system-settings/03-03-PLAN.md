---
phase: 03-applications-and-system-settings
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - setup
  - scripts/show-report.sh
autonomous: true

must_haves:
  truths:
    - "Running ./setup executes app installation after dotfiles setup"
    - "Running ./setup executes system settings after app installation"
    - "Completion report shows installed apps"
    - "Completion report shows applied system settings"
    - "Phase 3 integrates seamlessly with Phase 1 and 2 flow"
  artifacts:
    - path: "setup"
      provides: "Main entry point with Phase 3 integration"
      contains: ["install-apps.sh", "configure-system.sh"]
    - path: "scripts/show-report.sh"
      provides: "Updated completion report with apps and settings"
      contains: ["Applications", "System Settings"]
  key_links:
    - from: "setup"
      to: "scripts/install-apps.sh"
      via: "source or sh command"
      pattern: "install-apps"
    - from: "setup"
      to: "scripts/configure-system.sh"
      via: "source or sh command"
      pattern: "configure-system"
---

<objective>
Integrate app installation and system settings into the main setup flow

Purpose: Wire Phase 3 scripts into the setup entry point and update the completion report
Output: Updated setup script with Phase 3 section, updated show-report.sh with apps and settings
</objective>

<execution_context>
@/Users/mlaws/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mlaws/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-applications-and-system-settings/03-01-SUMMARY.md
@.planning/phases/03-applications-and-system-settings/03-02-SUMMARY.md
@setup
@scripts/show-report.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Phase 3 to setup script</name>
  <files>setup</files>
  <action>
Update the main setup script to include Phase 3 scripts.

**Add after Phase 2 section:**

```bash
# ============================================
# Phase 3: Applications & System Settings
# ============================================

source "$SCRIPT_DIR/scripts/install-apps.sh"
source "$SCRIPT_DIR/scripts/configure-system.sh"
```

**Ordering rationale (Claude's discretion from context):**
- Install apps first: System settings applied before apps install means apps inherit preferences
- Actually: Apply system settings FIRST - Dock/Finder/etc. preferences are immediately visible
- Then install apps - which can take time and benefit from configured system

Update the order to:
1. configure-system.sh (fast, immediate visual feedback)
2. install-apps.sh (can be slow, user sees configured system while waiting)

**Final Phase 3 section:**
```bash
# ============================================
# Phase 3: Applications & System Settings
# ============================================

source "$SCRIPT_DIR/scripts/configure-system.sh"
source "$SCRIPT_DIR/scripts/install-apps.sh"
```

Ensure the section comment matches the style of Phase 2 section.
  </action>
  <verify>
grep "Phase 3" setup shows section header exists
grep "configure-system.sh" setup shows system settings script sourced
grep "install-apps.sh" setup shows app installation script sourced
  </verify>
  <done>
setup script sources configure-system.sh and install-apps.sh in Phase 3 section, with system settings before apps
  </done>
</task>

<task type="auto">
  <name>Task 2: Update completion report with Phase 3 info</name>
  <files>scripts/show-report.sh</files>
  <action>
Update show-report.sh to include Phase 3 information in the completion summary.

**Read existing show-report.sh first to understand current structure.**

**Add sections for:**

1. **Applications Installed:**
   - If SKIPPED_APPS is set (from install-apps.sh), show partial installation warning
   - Otherwise show "All selected applications installed"
   - List categories that were installed (if available via export)

2. **System Settings Applied:**
   - If SKIPPED_SETTINGS is set (from configure-system.sh), show partial warning
   - Otherwise show "All selected system settings applied"
   - Note about keyboard settings requiring logout

**Example additions to report:**

```
Applications:
  ✓ All selected applications installed

System Settings:
  ✓ Dock: Auto-hide with fast animations
  ✓ Finder: Show extensions, column view
  ✓ Keyboard: Fast repeat (logout may be needed)
  ✓ Mouse/Trackpad: Maximum speed
  ✓ Screenshots: ~/Desktop/Screenshots (PNG)
```

**Handle missing exports gracefully:**
- If SKIPPED_APPS not set, assume success
- If INSTALLED_APPS not set, show generic success message
- If APPLIED_SETTINGS not set, show generic success message

Follow existing patterns in show-report.sh for consistent styling.
  </action>
  <verify>
grep "Applications" scripts/show-report.sh shows apps section exists
grep "System Settings" scripts/show-report.sh shows settings section exists
bash -n scripts/show-report.sh returns no syntax errors
  </verify>
  <done>
show-report.sh displays app installation status and system settings status in completion summary
  </done>
</task>

</tasks>

<verification>
1. Syntax check: `bash -n setup` passes
2. Syntax check: `bash -n scripts/show-report.sh` passes
3. Phase 3 scripts in correct order: grep shows configure-system before install-apps
4. Report includes new sections: grep for Applications and System Settings
5. Full setup flow runs: `./setup --help` shows help (quick validation script is executable)
</verification>

<success_criteria>
- setup script has Phase 3 section with both scripts sourced
- System settings configured before apps installed
- show-report.sh displays app and settings status
- No syntax errors in any modified scripts
- Phase 3 integrates with existing Phase 1 and 2 flow
</success_criteria>

<output>
After completion, create `.planning/phases/03-applications-and-system-settings/03-03-SUMMARY.md`
</output>
