---
phase: 03-applications-and-system-settings
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/configure-system.sh
autonomous: true

must_haves:
  truths:
    - "User sees preview of all system settings before any changes"
    - "User can customize which settings to apply via multi-select"
    - "All recommended settings are pre-selected by default"
    - "Dock auto-hides with fast animations after settings applied"
    - "Finder shows file extensions after settings applied"
    - "Screenshots save to ~/Desktop/Screenshots in PNG format"
    - "Keyboard has fast repeat rate with press-and-hold disabled"
    - "Mouse/trackpad operate at maximum speed"
  artifacts:
    - path: "scripts/configure-system.sh"
      provides: "macOS system preferences configuration with preview"
      min_lines: 150
  key_links:
    - from: "scripts/configure-system.sh"
      to: "scripts/lib/ui.sh"
      via: "source library"
      pattern: "source.*ui\\.sh"
    - from: "scripts/configure-system.sh"
      to: "macOS defaults"
      via: "defaults write commands"
      pattern: "defaults write"
---

<objective>
Create system settings configuration script with preview and customization

Purpose: Apply user's preferred macOS settings (Dock, Finder, Keyboard, Mouse, Screenshots) with preview showing all changes before applying
Output: configure-system.sh with gum-based multi-select, preview display, and grouped defaults commands
</objective>

<execution_context>
@/Users/mlaws/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mlaws/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-applications-and-system-settings/03-CONTEXT.md
@.planning/phases/03-applications-and-system-settings/03-RESEARCH.md
@scripts/lib/ui.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create system settings script with preview and selection</name>
  <files>scripts/configure-system.sh</files>
  <action>
Create configure-system.sh following established patterns.

**Script Structure:**

1. Source libraries (ui.sh, detect.sh)
2. Display section header: "Configuring System Settings"
3. Show preview of all settings with current values
4. Present multi-select with all settings pre-selected
5. Apply only selected settings
6. Restart affected services (Dock, Finder, SystemUIServer)

**Settings Categories (from 03-CONTEXT.md):**

**Dock:**
- Auto-hide: enabled (defaults write com.apple.dock autohide -bool true)
- Auto-hide delay: 0 seconds (defaults write com.apple.dock autohide-delay -float 0)
- Animation speed: 0.15 seconds (defaults write com.apple.dock autohide-time-modifier -float 0.15)
- Icon size: 36 pixels (defaults write com.apple.dock tilesize -int 36)

**Finder:**
- Show file extensions: enabled (defaults write NSGlobalDomain AppleShowAllExtensions -bool true)
- Column view default (defaults write com.apple.finder FXPreferredViewStyle -string "clmv")
- No .DS_Store on network (defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true)
- Show path bar (defaults write com.apple.finder ShowPathbar -bool true)

**Keyboard:**
- Disable press-and-hold (defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false)
- Fast repeat rate: 2 (defaults write NSGlobalDomain KeyRepeat -int 2)
- Short initial delay: 15 (defaults write NSGlobalDomain InitialKeyRepeat -int 15)

**Mouse/Trackpad:**
- Mouse speed: 3.0 (defaults write NSGlobalDomain com.apple.mouse.scaling -float 3.0)
- Trackpad speed: 3.0 (defaults write NSGlobalDomain com.apple.trackpad.scaling -float 3.0)

**Screenshots:**
- Create directory: mkdir -p "$HOME/Desktop/Screenshots"
- Location: ~/Desktop/Screenshots (defaults write com.apple.screencapture location -string "$HOME/Desktop/Screenshots")
- Format: PNG (defaults write com.apple.screencapture type -string "png")
- Disable shadow (defaults write com.apple.screencapture disable-shadow -bool true)

**Preview Display:**
Show grouped settings with what will change:
```
System Settings to Apply:

Dock:
  • Auto-hide: enabled (instant show, fast animation)
  • Icon size: 36 pixels

Finder:
  • Show all file extensions
  • Default to column view
  • Don't create .DS_Store on network drives
  • Show path bar

Keyboard:
  • Fast repeat rate (2)
  • Short initial delay (15)
  • Disable press-and-hold for key repeat

Mouse/Trackpad:
  • Maximum speed (3.0)

Screenshots:
  • Save to ~/Desktop/Screenshots
  • PNG format
  • No shadow
```

**Multi-select UI:**
Use gum choose --no-limit with --selected flags for all items:
```bash
SETTINGS=$(gum choose --no-limit \
    --header "Select settings to apply (all recommended by default):" \
    --selected="Dock: Auto-hide with fast animations" \
    --selected="Finder: Extensions, column view, no network .DS_Store" \
    --selected="Keyboard: Fast repeat, no press-and-hold" \
    --selected="Mouse/Trackpad: Maximum speed" \
    --selected="Screenshots: PNG to ~/Desktop/Screenshots" \
    "Dock: Auto-hide with fast animations" \
    "Finder: Extensions, column view, no network .DS_Store" \
    "Keyboard: Fast repeat, no press-and-hold" \
    "Mouse/Trackpad: Maximum speed" \
    "Screenshots: PNG to ~/Desktop/Screenshots")
```

**Apply Functions:**
Create separate functions for each category:
- apply_dock_settings()
- apply_finder_settings()
- apply_keyboard_settings()
- apply_input_settings() (mouse/trackpad)
- apply_screenshot_settings()

Each function applies all related defaults and calls appropriate killall.

**Service Restart:**
- After Dock settings: killall Dock
- After Finder settings: killall Finder
- After Screenshot settings: killall SystemUIServer
- Keyboard settings: Inform user logout may be needed for full effect

**Error Handling:**
- Wrap defaults commands in functions
- Report success/failure for each category
- Continue on individual failures
  </action>
  <verify>
bash -n scripts/configure-system.sh returns no syntax errors
grep -c "defaults write" scripts/configure-system.sh shows at least 12 occurrences
grep -c "killall" scripts/configure-system.sh shows at least 3 occurrences (Dock, Finder, SystemUIServer)
grep "gum choose --no-limit" scripts/configure-system.sh shows multi-select prompt
  </verify>
  <done>
configure-system.sh shows preview, presents multi-select with all settings pre-selected, applies user's choices, restarts affected services
  </done>
</task>

</tasks>

<verification>
1. Syntax check: `bash -n scripts/configure-system.sh` passes
2. All settings categories covered: grep for Dock, Finder, Keyboard, Mouse, Screenshot
3. Service restarts present: grep for "killall Dock", "killall Finder", "killall SystemUIServer"
4. Proper type flags used: grep shows -bool, -int, -float, -string with appropriate values
5. Pre-selection works: grep shows --selected flags in gum choose command
</verification>

<success_criteria>
- Script runs without syntax errors
- All 5 settings categories from context are implemented
- Preview shows grouped settings before selection
- Multi-select has all items pre-selected by default
- Each settings group has corresponding apply function
- Affected services are restarted after changes
- User informed about keyboard settings requiring logout
</success_criteria>

<output>
After completion, create `.planning/phases/03-applications-and-system-settings/03-02-SUMMARY.md`
</output>
